@using Shared.Models.Areas.Finishing
@using Shared.ViewModels.Areas.Finishing
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer localizer

@model PendingRegistViewModel

@*https://www.w3.org/WAI/tutorials/tables/irregular/  https://datatables.net/extensions/buttons/examples/column_visibility/index.html*@

<div class="d-flex justify-content-center" >
    <div class="spinner-border" role="status" id="myLoader" style="display:none">
      <span class="sr-only">Loading...</span>
    </div>
</div>
@if (Model == null)
{
    <div id="ResultPage">
        <h3 class="display-4 text-center">@localizer["NoModelData"]</h3>
    </div>
}
else
{
    int ProcessedTotal = 0;
    int ToPrintTotal = 0;
    int ToRegistPrintTotal = 0;
    int ToRegistFullFillTotal = 0;
    int TotalPrint = 0;
    int TotalPostObjs = 0;
    <div id="TitlePage">
        <h1>@localizer["PendingRegist"]</h1>
    </div>
    @if (Model.PendingRegist.Count() == 0)
    {
        <h4 class="display-4 text-center">@localizer["EmptyResult"]</h4>
    }
    else
    {
         <table class="table table-sm table-hover table-collapse-seperate table-shadow">
            <thead id="bootstrap-overrides" class="sticky-header">
                <tr>
                    <th colspan="3" style="padding: 10px; border-top-left-radius: 20px;">@localizer["Run"]</th>
                    <th colspan="4" style="padding: 10px; border-top-right-radius: 20px;">@localizer["Files"]</th>
                </tr>
                <tr>
                    <th>@localizer["RunDescription"]</th>
                    <th>@localizer["TotalPrint"]</th>
                    <th>@localizer["TotalPostObjs"]</th>
                    <th>@localizer["TotalProcessed"]</th>
                    <th>@localizer["FilesLeftToPrint"]</th>
                    <th>@localizer["FilesLeftToRegistPrint"]</th>
                    <th>@localizer["FilesLeftToRegistFullFill"]</th>
                </tr>
            </thead>
            <tbody id="bootstrap-overrides">
                @foreach (PendingRegistInfo p in Model.PendingRegist)
                {
                    <tr>
                        @{
                            DateTime rDate;
                            string runDate = p.RunDate.ToString();
                            if (DateTime.TryParseExact(p.RunDate.ToString(), "yyyyMMdd",
                            System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None, out rDate))
                                runDate = rDate.ToShortDateString();
                            string RunName = runDate + " [" + p.RunSequence + "]";
                        }
                        <td style="background:var(--lightestgrey);">
                            <a class="btn btn-link link-info" asp-area="Finishing" asp-controller="PendingRegist" asp-action="PendingRegistDetail" asp-route-runid="@p.RunID" asp-route-runname="@p.BusinessDesc - @RunName">
                                @p.BusinessDesc
                                <br>
                                @RunName
                            </a>
                        </td>
                        <td>@p.TotalPrint</td>
                        @{
                            TotalPrint += p.TotalPrint;
                        }
                        <td>@p.TotalPostObjs</td>
                        @{
                            TotalPostObjs += p.TotalPostObjs;
                        }
                        <td>@p.TotalProcessed</td>
                        @{
                            ProcessedTotal += p.TotalProcessed;
                        }
                        <td>@p.FilesLeftToPrint</td> 
                        @{
                            ToPrintTotal += p.FilesLeftToPrint;
                        }
                        <td>@p.FilesLeftToRegistPrint</td>
                        @{
                            ToRegistPrintTotal += p.FilesLeftToRegistPrint;
                        }
                        <td>@p.FilesLeftToRegistFullFill</td>
                        @{
                            ToRegistFullFillTotal += p.FilesLeftToRegistFullFill;
                        }
                    </tr>
                }
                <tr style="background:var(--lightestgrey); border: var(--orange)">
                    <td style="background:var(--lightergrey); padding: 10px; border-bottom-left-radius: 20px;"><b>@localizer["Totals"]</b></td>
                    <td style="background:var(--lightergrey);"><b>@TotalPrint</b></td>
                    <td style="background:var(--lightergrey);"><b>@TotalPostObjs</b></td>
                    <td style="background:var(--lightergrey);"><b>@ProcessedTotal</b></td>
                    <td style="background:var(--lightergrey);"><b>@ToPrintTotal</b></td>
                    <td style="background:var(--lightergrey);"><b>@ToRegistPrintTotal</b></td>
                    <td style="background:var(--lightergrey); padding: 10px; border-bottom-right-radius: 20px;"><b>@ToRegistFullFillTotal</b></td>
               </tr>
            </tbody>
        </table>
    }
}