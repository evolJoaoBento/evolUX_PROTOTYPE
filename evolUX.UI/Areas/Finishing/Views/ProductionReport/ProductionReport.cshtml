@using Shared.Models.Areas.Finishing
@using Shared.ViewModels.Areas.Finishing
@using Newtonsoft.Json;
@model ProductionReportViewModel;
@*https://www.w3.org/WAI/tutorials/tables/irregular/  https://datatables.net/extensions/buttons/examples/column_visibility/index.html*@

<div class="d-flex justify-content-center" >
    <div class="spinner-border" role="status" id="myLoader" style="display:none">
      <span class="sr-only">Loading...</span>
    </div>
    <div class="d-flex justify-content-center">
        <h2 class="display-4 text-center">@ViewBag.RunName</h2>
    </div>
</div>
@foreach (ProductionDetailInfo pinfo in Model.ProductionReport)
{

    <table class="table table-bordered table-sm table-hover">
        <col>
        <col>
        @{
            int printingSpan = 5 + pinfo.ProductionDetailReport.First().PaperTotals.Keys.Count;
        }
        <colgroup span="@printingSpan"></colgroup>
        @{
            int envelopingSpan = 4;
            if (pinfo.ProductionDetailReport.First().StationTotals != null)
            {
                envelopingSpan += pinfo.ProductionDetailReport.First().StationTotals.Keys.Count;
            }
        }
        <colgroup span="@envelopingSpan"></colgroup>
        <colgroup span="5"></colgroup>
        <thead class="table-info">
            <tr class="text-center">
                <th rowspan="3" scope="col">File</th>@*FileName RegistShortFileName*@
                <th rowspan="3" scope="col">Treatment</th>@*ServiceTaskCode*@
                <th colspan="@printingSpan" scope="colgroup">Printing</th>
                <th colspan="@envelopingSpan" scope="colgroup">Enveloping</th>
                <th colspan="5" scope="colgroup">Expedition</th>
            </tr>
            <tr class="text-center">
                <th rowspan="2" scope="col">Operator [Printer]</th>@*PrinterOperator + Printer*@
                <th rowspan="2" scope="col">Type</th>@*PlexCode*@
                <th rowspan="2" scope="col">Amount</th>@*TotalPrint*@
                <th colspan="2" scope="colgroup">Sequence Number</th>
                <th colspan="@pinfo.ProductionDetailReport.First().PaperTotals.Keys.Count" scope="colgroup">Materials</th>
                <th colspan="2" scope="colgroup">Envelope</th>
                <th rowspan="2" scope="col">Amount</th> @*TotalPostObjs*@
                <th rowspan="2" scope="col">Level</th>@*ExpLevel*@
                @if (pinfo.ProductionDetailReport.First().StationTotals != null)
                {
                    <th colspan="@pinfo.ProductionDetailReport.First().StationTotals.Keys.Count" scope="colgroup">Stations</th>
                }
                <th rowspan="2" scope="col">Company</th>@*ExpCompanyCode*@
                <th rowspan="2" scope="col">Expedition Center</th>@*ExpCenterCodeDesc*@
                <th rowspan="2" scope="col">Zone</th>@*ExpeditionZone*@
                <th rowspan="2" scope="rowgroup">Type</th>@*RegistDetailFilePrintedFlag*@
            </tr>
            <tr class="text-center">
                <th scope="col">Start</th>@*StartSeqNum*@
                <th scope="col">End</th>@*EndSeqNum*@
                @foreach(string paper in pinfo.ProductionDetailReport.First().PaperTotals.Keys)
                {
                    <th scope="row">@paper</th>
                }
                <th scope="col">Format</th>@*FullFillMaterialCode*@
                <th scope="col">Material</th>@*FullFillMaterialRef*@
                @if (pinfo.ProductionDetailReport.First().StationTotals != null)
                {
                    @foreach (string station in pinfo.ProductionDetailReport.First().StationTotals.Keys)
                    {
                        <th scope="row">@station</th>
                    }
                }
            </tr>
        </thead>
        <tbody>
            @if (Model == null)
            {
                <tr><td colspan="5" class="text-center">No Model Data</td></tr>
            }
            else
            {
                @foreach (ProductionInfo p in pinfo.ProductionDetailReport)
                {
                    <tr>
                        <td>
                            @*<form asp-controller="ProductionReport" asp-action="FilePrint" method="post">
                                <button class="btn btn-link link-info">@p.FileName</button>
                                <input type="hidden" name="RunID" value="@p.RunID" />
                                <input type="hidden" name="FileID" value="@p.FileID" />
                                <input type="hidden" name="FilePath" value="@p.FilePath" />
                                <input type="hidden" name="FileName" value="@p.FileName" />
                                <input type="hidden" name="ShortFileName" value="@p.ShortFileName" />
                                <input type="hidden" name="FilePrinterSpecs" value="@p.FilePrinterSpecs" />
                            </form>*@
                            <a class="btn btn-link link-info" asp-area="Finishing" asp-controller="Print"
                   asp-action="Printing" asp-route-JsonSerializedProductionInfo="@JsonConvert.SerializeObject(p)" asp-route-FilePrinterSpecs=@p.FilePrinterSpecs>@p.FileName</a>
                            @if (p.RegistDetailFileName!=null)
                            {
                                @*<form asp-page-handler="FilePrint" method="post">
                                    <button class="btn btn-link btn-sm evolflow-link">@p.RegistDetailFileName</button>
                                    <input type="hidden" name="RunID" value="@p.RunID" />
                                    <input type="hidden" name="FileID" value="@p.FileID" />
                                    <input type="hidden" name="FilePath" value="@p.FilePath" />
                                    <input type="hidden" name="FileName" value="@p.RegistDetailFileName" />
                                    <input type="hidden" name="ShortFileName" value="@p.RegistDetailShortFileName" />
                                    <input type="hidden" name="FilePrinterSpecs" value="@p.RegistDetailFilePrinterSpecs" />
                                </form>*@
                            }
                            </td>
                        <td>@p.ServiceTaskCode</td>
                        <td>@if (p.PrinterOperator != null)
                            {
                                <div>@p.PrinterOperator [@p.Printer]</div> 
                            }
                        </td>
                        <td>@p.PlexCode</td>
                        <td>@p.TotalPrint</td>
                        <td>@p.StartSeqNum</td>
                        <td>@p.EndSeqNum</td>
                        @foreach(string paper in p.PaperTotals.Keys)
                        {
                            <td scope="row">@p.PaperTotals[paper]</td>
                        }
                        <td>@p.FullFillMaterialCode</td>
                        <td>@p.FullFillMaterialRef</td>
                        <td>@p.TotalPostObjs</td>
                        @if (pinfo.ProductionDetailReport.First().StationTotals != null)
                        {
                            @foreach (string station in p.StationTotals.Keys)
                            {
                                <td scope="row">@p.StationTotals[station]</td>
                            }
                            
                        }
                        <td>@p.ExpLevel</td>
                        <td>@p.ExpCompanyCode</td>
                        <td>@p.ExpCenterCode</td>
                        <td>@p.ExpeditionZone</td>
                        <td>@p.RegistDetailFilePrintedFlag</td>
                        
                        @*<td><a asp-area="EvolDP" asp-controller="DocCode" asp-action="DocCodeLevel1" asp-route-doclayout="@p.DocLayout" asp-route-docsubtype="@p.DocType">Mais</a></td>*@
                    </tr>
                }
            }
        </tbody>
    </table>
}
    



