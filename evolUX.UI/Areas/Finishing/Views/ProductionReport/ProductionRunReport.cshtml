@using Shared.Models.Areas.Finishing
@using Shared.ViewModels.Areas.Finishing
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer localizer
@model ProductionRunReportViewModel

@*https://www.w3.org/WAI/tutorials/tables/irregular/  https://datatables.net/extensions/buttons/examples/column_visibility/index.html*@
@{
    bool PrintFile = false;

    if (Model.Permissions.Find(x => x == "PrintFile") != null) { PrintFile = true; }
    int totalFilesLeftToPrint = Model.ProductionRunReport.Sum(x => x.FilesLeftToPrint);
    int totalRecFilesLeftToPrint = Model.ProductionRunReport.Sum(x => x.RecFilesLeftToPrint);
}
<div class="d-flex justify-content-center" >
    <div class="spinner-border" role="status" id="myLoader" style="display:none">
      <span class="sr-only">Loading...</span>
    </div>
</div>
@if (Model == null || Model.ProductionRunReport == null)
{
    <div id="ResultPage">
        <h3 class="display-4 text-center">@localizer["NoModelData"]</h3>
    </div>
}
else
{
    @if (Model.ProductionRunReport.Count() == 0)
    {
        <div id="ResultPage">
            <h3 class="display-4 text-center">@localizer["NoPendingProductions"]</h3>
        </div>
    }
    else
    {
        <div id="TitlePage">
            <h1>@localizer["ProductionRunStatus"]</h1>
        </div>
        @if (!string.IsNullOrEmpty(ViewBag.Source))
        {
            <a class='bx bx-left-arrow' style="color:rgb(90 205 239)" asp-area="Finishing" asp-controller="ProductionReport" asp-action="Index"></a>
        }
            @if (Model.ProductionRunReport.Count() == 0)
            {
                <div class="my-3">
                    <h4 class="display-4 text-center">@localizer["EmptyResult"]</h4>
                </div>
            }
            else
            {
                string ServiceCompanyName = "";
                if (ViewBag.hasMultipleServiceCompanies)
                {
                    ServiceCompanyName += TempData["ServiceCompanyName"];
                }

            <div class="my-3">
                <table class="table table-sm table-hover table-collapse-seperate table-shadow" style="border-radius: 25px">
                    <thead id="bootstrap-overrides" class="sticky-header">
                        <tr>
                            <th class="borders" rowspan="3" style="text-align:center;vertical-align:middle">
                                @if (PrintFile && (totalFilesLeftToPrint > 0 || totalRecFilesLeftToPrint > 0))
                                {
                                    <a asp-area="Finishing" asp-controller="ProductionReport" asp-action="ProductionReportPrinter" asp-route-runidlist="@string.Join("|", Model.ProductionRunReport.Select(x => x.RunID).ToList())" asp-route-servicecompanyid="@TempData["ServiceCompanyID"]" asp-route-runname="">
                                        <img class="evol-image grow" style="width:35px;height:35px" src="~/images/printer-solid-24.png">
                                    </a>
                                }
                            </th>
                            <th rowspan="3" scope="rowgroup" style="vertical-align:middle; padding: 10px;" class="head-l">
                                <div class="highlight-data">@ServiceCompanyName</div>@localizer["RunDescription"]</th> @*BusinessDesc + [BusinessID] + RunDate + (RunSequence + [RunID])*@
                            <th colspan="20" scope="rowgroup" style="vertical-align:middle; padding: 10px;" class="head-r">@localizer["Files"]</th>
                        </tr>
                        <tr>
                            <th colspan="2" scope="colgroup" style="vertical-align:middle">@localizer["TotalToPrint"]</th>
                            <th colspan="3" scope="colgroup" style="vertical-align:middle">@localizer["Processed"]</th>
                            <th colspan="3" scope="colgroup" style="vertical-align:middle">@localizer["ToPrint"]</th>
                            <th colspan="3" scope="colgroup" style="vertical-align:middle">@localizer["S2Printer"]</th>
                            <th colspan="3" scope="colgroup" style="vertical-align:middle">@localizer["Printed"]</th>
                            <th colspan="3" scope="colgroup" style="vertical-align:middle">@localizer["FullFill"]</th>
                            <th colspan="3" scope="colgroup" style="vertical-align:middle">@localizer["Expedition"]</th>
                        </tr>
                        <tr>
                            <th scope="row" style="vertical-align:middle">@localizer["Originals"]</th>
                            <th scope="row" style="vertical-align:middle">@localizer["Recup"]</th>
                            <th scope="row" style="vertical-align:middle">@localizer["Total"]</th>
                            <th scope="row" style="vertical-align:middle">@localizer["StartProcessed"]</th>
                            <th scope="row" style="vertical-align:middle">@localizer["EndProcessed"]</th>
                            <th scope="row" style="vertical-align:middle">@localizer["Total"]</th>
                            <th scope="row" style="vertical-align:middle">@localizer["StartToPrint"]</th>
                            <th scope="row" style="vertical-align:middle">@localizer["EndToPrint"]</th>
                            <th scope="row" style="vertical-align:middle">@localizer["Total"]</th>
                            <th scope="row" style="vertical-align:middle">@localizer["StartS2Printer"]</th>
                            <th scope="row" style="vertical-align:middle">@localizer["EndS2Printer"]</th>
                            <th scope="row" style="vertical-align:middle">@localizer["Total"]</th>
                            <th scope="row" style="vertical-align:middle">@localizer["StartPrinted"]</th>
                            <th scope="row" style="vertical-align:middle">@localizer["EndPrinted"]</th>
                            <th scope="row" style="vertical-align:middle">@localizer["Total"]</th>
                            <th scope="row" style="vertical-align:middle">@localizer["StartFullFill"]</th>
                            <th scope="row" style="vertical-align:middle">@localizer["EndFullFill"]</th>
                            <th scope="row" style="vertical-align:middle">@localizer["Total"]</th>
                            <th scope="row" style="vertical-align:middle">@localizer["StartExpedition"]</th>
                            <th scope="row" style="vertical-align:middle">@localizer["EndExpedition"]</th>
                        </tr>
                    </thead>
                    <tbody id="bootstrap-overrides">
                        @{
                            int OriginalsTotal = 0;
                            int RecupTotal = 0;
                            int ProcessedTotal = 0;
                            int ToPrintTotal = 0;
                            int S2PrinterTotal = 0;
                            int PrintedTotal = 0;
                            int FullFillTotal = 0;
                            int ExpeditionTotal = 0;
                        }
                        @foreach (ProductionRunInfo p in Model.ProductionRunReport)
                        {
                            <tr>
                                @{
                                    DateTime rDate;
                                    string runDate = p.RunDate.ToString();
                                    if (DateTime.TryParseExact(p.RunDate.ToString(), "yyyyMMdd",
                                    System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None, out rDate))
                                        runDate = rDate.ToShortDateString();
                                    string RunName = runDate + " [" + p.RunSequence + "]";
                                }
                                <td class="borders" style="text-align:center;vertical-align:middle">
                                    @if (p.FilesLeftToPrint > 0 || p.RecFilesLeftToPrint > 0)
                                    {
                                        <a asp-area="Finishing" asp-controller="ProductionReport" asp-action="ProductionReport" asp-route-runidlist="@p.RunID" asp-route-servicecompanyid="@p.ServiceCompanyID" asp-route-runname=@RunName>
                                            <img class="evol-image grow" src="~/images/report_orange.png" />
                                        </a>
                                    }
                                    else
                                    {
                                        <a asp-area="Finishing" asp-controller="ProductionReport" asp-action="ProductionReport" asp-route-runidlist="@p.RunID" asp-route-servicecompanyid="@p.ServiceCompanyID" asp-route-runname=@RunName>
                                            <img class="evol-image grow" src="~/images/report.png" />
                                        </a>
                                    }
                                    @*@if (PrintFile && (p.FilesLeftToPrint > 0 || p.RecFilesLeftToPrint > 0))
                                    {
                                    <a class='bx bx-printer' style="color:rgb(245 126 72)" asp-area="Finishing" asp-controller="ProductionReport" asp-action="ProductionReportPrinter" asp-route-runidlist="@p.RunID" asp-route-servicecompanyid="@p.ServiceCompanyID" asp-route-runname=@RunName></a>
                                    }
                                    *@
                                </td>
                                <td class="headcol">
                                    @p.BusinessDesc <br> @RunName
                                </td>
                                <td>@p.FilesLeftToPrint</td> @*Originals*@
                                @{
                                    OriginalsTotal += p.FilesLeftToPrint;
                                }
                                <td>@p.RecFilesLeftToPrint</td> @*Recup*@
                                @{
                                    RecupTotal += p.RecFilesLeftToPrint;
                                }
                                <td>@p.TotalProcessed</td>
                                @{
                                    ProcessedTotal += p.TotalProcessed;
                                }
                                <td>
                                    @if (p.StartProcessed != DateTime.MinValue)
                                        @p.StartProcessed
                                    </td>
                                    <td>
                                        @if (p.EndProcessed != DateTime.MinValue)
                                        @p.EndProcessed
                                    </td>
                                    <td>@p.TotalToPrint</td>
                                    @{
                                    ToPrintTotal += p.TotalToPrint;
                                }
                                <td>
                                    @if (p.StartToPrint != DateTime.MinValue)
                                        @p.StartToPrint
                                    </td>
                                    <td>
                                        @if (p.EndToPrint != DateTime.MinValue)
                                        @p.EndToPrint
                                    </td>
                                    <td>@p.TotalS2Printer</td>
                                    @{
                                    S2PrinterTotal += p.TotalS2Printer;
                                }
                                <td>
                                    @if (p.StartS2Printer != DateTime.MinValue)
                                        @p.StartS2Printer

                                    </td>
                                    <td>
                                        @if (p.EndS2Printer != DateTime.MinValue)
                                        @p.EndS2Printer
                                    </td>
                                    <td>@p.TotalPrinted</td>
                                    @{
                                    PrintedTotal += p.TotalPrinted;
                                }
                                <td>
                                    @if (p.StartPrinted != DateTime.MinValue)
                                        @p.StartPrinted
                                    </td>
                                    <td>
                                        @if (p.EndPrinted != DateTime.MinValue)
                                        @p.EndPrinted
                                    </td>
                                    <td>@p.TotalFullFill</td>
                                    @{
                                    FullFillTotal += p.TotalFullFill;
                                }
                                <td>
                                    @if (p.StartFullFill != DateTime.MinValue)
                                        @p.StartFullFill
                                    </td>
                                    <td>
                                        @if (p.EndFullFill != DateTime.MinValue)
                                        @p.EndFullFill
                                    </td>
                                    <td>@p.TotalExpedition</td>
                                    @{
                                    ExpeditionTotal += p.TotalExpedition;
                                }
                                <td>
                                    @if (p.StartExpedition != DateTime.MinValue)
                                        @p.StartExpedition

                                    </td>
                                    <td>
                                        @if (p.EndExpedition != DateTime.MinValue)
                                        @p.EndExpedition
                                    </td>
                                    @*<td><a asp-area="EvolDP" asp-controller="DocCode" asp-action="DocCodeLevel1" asp-route-doclayout="@p.DocLayout" asp-route-docsubtype="@p.DocType">Mais</a></td>*@
                                </tr>
                        }
                        <tr class="table-end">
                            <td class="table-end-data headcol borders" style="box-shadow: 0px 10px 10px #FFFFFF; background-color: #FFFFFF">Total</td>
                            <td class="table-end-data" style="border-bottom-left-radius: 20px;">@OriginalsTotal</td> @*Originals*@
                            <td class="table-end-data">@RecupTotal</td> @*Recup*@
                            <td class="table-end-data">@ProcessedTotal</td>
                            <td></td>
                            <td></td>
                            <td class="table-end-data">@ToPrintTotal</td>
                            <td></td>
                            <td></td>
                            <td class="table-end-data">@S2PrinterTotal</td>
                            <td></td>
                            <td></td>
                            <td class="table-end-data">@PrintedTotal</td>
                            <td></td>
                            <td></td>
                            <td class="table-end-data">@FullFillTotal</td>
                            <td></td>
                            <td></td>
                            <td class="table-end-data">@ExpeditionTotal</td>
                            <td></td>
                            <td style="border-bottom-right-radius: 20px;"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        }
    }
}



