@using Shared.Models.Areas.evolDP
@using Shared.ViewModels.Areas.evolDP
@using Newtonsoft.Json;
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer localizer
@inject IConfiguration configuration

@model ExpCompanyConfigViewModel;
@{
    string siteURL = configuration.GetValue<string>("evolUXSiteURL");
    bool AddExpCompany = false;
    bool AddExpeditionContract = false;
    bool DeleteExpeditionContract = false;
    bool ExportExpeditionContract = false;
    bool AddExpeditionType = false;
    bool AddExpRegistRange = false;
    bool ExportExpRegistRange = false;

    if (Model.Permissions.Find(x => x == "AddExpeditionType") != null) { AddExpeditionType = true; }
    if (Model.Permissions.Find(x => x == "AddExpCompany") != null) { AddExpCompany = true; }
    if (Model.Permissions.Find(x => x == "AddExpeditionContract") != null) { AddExpeditionContract = true; }
    if (Model.Permissions.Find(x => x == "DeleteExpeditionContract") != null) { DeleteExpeditionContract = true; }
    if (Model.Permissions.Find(x => x == "ExportExpeditionContract") != null) { ExportExpeditionContract = true; }
    if (Model.Permissions.Find(x => x == "AddExpRegistRange") != null) { AddExpRegistRange = true; }
    if (Model.Permissions.Find(x => x == "ExportExpRegistRange") != null) { ExportExpRegistRange = true; }
}
@if (Model == null || Model.Configs == null)
{
    <tr><td colspan="5" class="text-center">@localizer["NoModelData"]</td></tr>
}
else
{
    Company expCompany = Model.ExpCompany;
    List<ExpeditionZoneElement> zonesNotInList = new List<ExpeditionZoneElement>();
    string value;
    int level0 = 0, level1 = 0;
    string idValue = "arrow" + level0.ToString();
    string nameValue = "";
    string headerDesc = expCompany.CompanyName;
    int OldExpeditionType = Model.ExpeditionType;
    int OldExpeditionZone = Model.ExpeditionZone;
    int OldStartDate = 0;
    if (Model.ExpeditionZone == 0)
    {
        foreach (ExpeditionZoneElement z in Model.Zones)
        {
            if (Model.Configs.Where(x => x.ExpeditionZone == z.ExpeditionZone).Count() == 0)
                zonesNotInList.Add(z);
        }
    }

    <div id="TitlePage">
        <h1>@localizer["ExpCompanyConfig"]</h1>
        <h2>@headerDesc</h2>
    </div>
    <div>
        <a class='bx bx-left-arrow' style="color:rgb(90 205 239)" asp-area="evolDP" asp-controller="Expedition" asp-action="ExpCompany" asp-route-expcompanyJson="@JsonConvert.SerializeObject(Model.ExpCompany)" asp-route-typesJson="@JsonConvert.SerializeObject(Model.ExpTypes)">
        </a>
    </div>
  @*  <table class="table table-sm table-hover table-collapse-seperate">
        <thead id="bootstrap-overrides" class="table-info sticky-header">
            <tr>
                <th>@localizer["Action"]</th>
                <th>@localizer["ExpeditionType"]</th>
                <th colspan="10">@localizer["ExpeditionZone"]</th>
            </tr>
        </thead>
        <tbody>
            @foreach (ExpCompanyConfig c in Model.expCompanyView.Configs)
            {
                value = c.ExpeditionType.ToString();
                if (Model.ExpeditionType != 0)
                {
                    @if (AddExpeditionType && Model.ExpeditionZone == 0)
                    {
                        <tr id="Hide|Zone|@value" style="display: none">
                            <th></th>
                            <th></th>
                            <th></th>
                            <th>@localizer["StartDate"]</th>
                            <th>@localizer["ExpCompanyLevel"]</th>
                            <th>@localizer["MaxWeight"]</th>
                            <th>@localizer["UnitCost"]</th>
                            <th>@localizer["ExpColumnA"]</th>
                            <th>@localizer["ExpColumnB"]</th>
                            <th>@localizer["ExpColumnE"]</th>
                            <th>@localizer["ExpColumnI"]</th>
                            <th>@localizer["ExpColumnF"]</th>
                        </tr>
                        <tr id="Hide|Zone|@value" style="display: none">
                            <form id="AddFrm|Zone|@value" class="d-flex justify-content-center m-5" asp-area="evolDP" asp-controller="Expedition" asp-action="ExpCompanyConfigAdd"
                  asp-route-expcompanyJson="@JsonConvert.SerializeObject(Model.expCompanyView.ExpCompany)">
                            <td style="align-items:center; display:flex">
                                <img onclick="CancelRow('TypeZone')" type="image" style="background:none; width:25px;height:25px;" src="~/images/cancel.png" title="@localizer["Cancel"]" />
                                <input onclick="return true" type="image" value="@localizer["SubmitChange"]" style="background:none; width:25px;height:25px;" name="Submit" src="~/images/Ok.png" />
                            </td>
                            <td>
                                    @c.ExpeditionTypeDesc
                                <input style="display: none" id="ExpeditionType" name="ExpeditionType" type="text" value="@c.ExpeditionType" />
                            </td>
                            <td>
                                <select id="ExpeditionZone" name="ExpeditionZone">
                                        @foreach (ExpeditionZoneElement z in zonesNotInList)
                                        {
                                        <option value="@z.ExpeditionZone">@z.Description</option>
                                        }
                                </select>
                            </td>
                            <td><input type="date" id="StartDate" name="StartDate" /></td>
                            <td></td>
                            <td><input type="number" min="0" max="1000000" id="MaxWeight" name="MaxWeight" value="0" /></td>
                            <td><input type="number" min="0" max="1000000" id="UnitCost" name="UnitCost" value="0" /></td>
                            <td><input type="text" id="ExpColumnA" name="ExpColumnA" maxlength="10" value="" /></td>
                            <td><input type="text" id="ExpColumnB" name="ExpColumnB" maxlength="10" value="" /></td>
                            <td><input type="text" id="ExpColumnE" name="ExpColumnE" maxlength="10" value="" /></td>
                            <td><input type="text" id="ExpColumnI" name="ExpColumnI" maxlength="10" value="" /></td>
                            <td><input type="text" id="ExpColumnF" name="ExpColumnF" maxlength="10" value="" /></td>
                            </form>
                        </tr>
                    }
                }
                if(OldExpeditionType != c.ExpeditionType || OldExpeditionZone != c.ExpeditionZone)
                {
                    level0++;
                    nameValue = "level0|" + level0.ToString();
                    idValue = "arrow" + nameValue;
                }
                <tr>
                    @if (AddExpeditionType)
                    {
                        <td>
                            <img onclick="EditRow('Zone|@value')" style="background:none; width:25px;height:25px;" src="~/images/add.png" title="@localizer["ExpCompanyConfigAdd"]" />
                        </td>
                    }
                    <td>@c.ExpeditionTypeDesc</td>
                    <td colspan="10">@c.ExpeditionZoneDesc
                        @if (OldExpeditionType != c.ExpeditionType || OldExpeditionZone != c.ExpeditionZone)
                        {
                            <a class="bx bxs-chevron-down" href="javascript:showDetail('@nameValue')" id="@idValue"></a>
                        }
                    </td>
                </tr>
                value = c.ExpeditionType.ToString() + "|" + c.ExpeditionZone.ToString() + "|" + c.ExpCompanyLevel;
                <tr id="Show|@value">
                    @if (AddExpeditionType)
                    {
                        <td>
                            <img onclick="EditRow('@value')" style="background:none; width:25px;height:25px;" src="~/images/edit.png" title="@localizer["ExpCompanyConfigChange"]" />
                        </td>
                    }
                    <td>@c.ExpeditionTypeDesc</td>
                    <td>@c.ExpeditionZoneDesc
                        @if (OldExpeditionType != c.ExpeditionType || OldExpeditionZone != c.ExpeditionZone)
                        {
                            <a class="bx bxs-chevron-down" href="javascript:showDetail('@nameValue')" id="@idValue"></a>
                        }
                    </td>
                    @{
                        value = c.RegistMode ? "checked" : "";
                    }
                    <td><input type="checkbox" id="RegistMode" @value disabled /></td>
                    @{
                        value = c.SeparationMode ? "checked" : "";
                    }
                    <td><input type="checkbox" id="SeparationMode" @value disabled /></td>
                    @{
                        value = c.BarcodeRegistMode != null ? ((bool)c.BarcodeRegistMode ? "1" : "0") : "0";
                    }
                    <td>@value</td>
                    @{
                        value = c.GenerateDetailRegist ? "checked" : "";
                    }
                    <td><input type="checkbox" id="GenerateDetailRegist" @value disabled /></td>
                    @{
                        value = c.DRFlagRegistado ? "checked" : "";
                    }
                    <td><input type="checkbox" id="DRFlagRegistado" @value disabled /></td>
                    @{
                        value = c.DRFlagEncomenda ? "checked" : "";
                    }
                    <td><input type="checkbox" id="DRFlagEncomenda" @value disabled /></td>
                    @{
                        value = c.DRFlagPessoal ? "checked" : "";
                    }
                    <td><input type="checkbox" id="DRFlagPessoal" @value disabled /></td>
                </tr>
                    @if (AddExpeditionType)
                    {
                        value = c.ExpeditionType.ToString();
                        <tr id="Hide|@value" style="display: none">
                            <form id="AddFrm|@value" class="d-flex justify-content-center m-5" asp-area="evolDP" asp-controller="Expedition" asp-action="ChangeExpCompanyType"
                    asp-route-expeditiontypeJson="@JsonConvert.SerializeObject(c)" asp-route-specificExpCompany="true">
                            <td style="align-items:center; display:flex">
                                <img onclick="CancelRow('@value')" type="image" style="background:none; width:25px;height:25px;" src="~/images/cancel.png" title="@localizer["Cancel"]" />
                                <input onclick="return true" type="image" value="@localizer["SubmitChange"]" style="background:none; width:25px;height:25px;" name="Submit" src="~/images/Ok.png" />
                            </td>
                                <td>@c.Description</td>
                                @{
                                    value = c.RegistMode ? "checked" : "";
                                }
                            <td><input onchange="RegistModeChange()" type="checkbox" id="RegistMode" name="RegistMode" @value /></td>
                                @{
                                    value = c.SeparationMode ? "checked" : "";
                                }
                            <td><input type="checkbox" id="SeparationMode" name="SeparationMode" @value /></td>
                                @{
                                    value = c.BarcodeRegistMode != null ? ((bool)c.BarcodeRegistMode ? "1" : "0") : "0";
                                }
                            <td><input type="number" min="0" max="1" id="BarcodeRegistMode" name="BarcodeRegistMode" value="@value" /></td>
                                @{
                                    value = c.GenerateDetailRegist ? "checked" : "";
                                    nameValue = value + "DRFlagGenerateDetailRegist";
                                }
                            <td><input type="checkbox" id="@nameValue" @value disabled /></td>
                                @{
                                    value = c.DRFlagRegistado ? "checked" : "";
                                    nameValue = value + "DRFlagRegistado";
                                }
                            <td><input type="checkbox" id="@nameValue" @value disabled /></td>
                                @{
                                    value = c.DRFlagEncomenda ? "checked" : "";
                                    nameValue = value + "DRFlagEncomenda";
                                }
                            <td><input type="checkbox" id="@nameValue" @value disabled /></td>
                                @{
                                    value = c.DRFlagPessoal ? "checked" : "";
                                    nameValue = value + "DRFlagPessoal";
                                }
                            <td><input type="checkbox" id="@nameValue" @value disabled /></td>

                            </form>
            }
                </tr>
                }
            }
        </tbody>
    </table>*@
}
@section Scripts
    {
    <script type="text/javascript">
        function RegistModeChange() {
            var checkbox = document.getElementById("RegistMode");
            chkElements = document.querySelectorAll('input[id^="checkedDRFlag"]');
            chkElements.forEach(tElement => {
                tElement.checked = checkbox.checked;
            });
        }
        function CancelRow(value) {
            eShide('Hide|' + value);
            eSshow('Show|' + value);
            var obj = document.getElementById("AddFrm|" + value);
            obj.disabled = true;
            return false;
        }
        function EditRow(value) {
            eShide('Show|' + value);
            eSshow('Hide|' + value);
            var obj = document.getElementById("AddFrm|" + value);
            obj.disabled = false;

            let str = 'Hide|' + value;
            trElements = document.querySelectorAll('tr[id^="Hide|"]');
            trElements.forEach(tElement => {
                if (tElement.id != str) {
                    let val = tElement.id.substring(5);
                    CancelRow(val);
                }
            });
        }
    </script>
}